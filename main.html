<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width">
		<title>Project IAM</title>
		<!-- <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico"> -->

		<!-- css -->
		<link rel="stylesheet" href="resource/css/main.css">
		<link rel="stylesheet" href="resource/css/sub.css">
		<link rel="stylesheet" href="resource/css/reset.css">
		<!-- //css -->

		<!-- script -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
		<!-- //script -->
	</head>
	<body>
		<div id="wrapper">
			<div class="main_visual_wrap" style="background: #f9f9f9;">
				<div class="main_visual_box">
					<h1>누구시조</h1>
					<p>Java 6기 21조</p>
				</div>
			</div>
			<div class="team_info_box wrap">
				<strong>누구시조 <br>소개</strong>
				<p>정기회의 회기는 100일을, 임시회의 회기는 30일을 초과할 수 없다. 누구든지 체포 또는 구속을 당한 때에는 즉시 변호인의 조력을 받을 권리를 가진다. 다만, 형사피고인이 스스로 변호인을 구할 수 없을 때에는 법률이 정하는 바에 의하여 국가가 변호인을 붙인다.
					대통령은 국회에 출석하여 발언하거나 서한으로 의견을 표시할 수 있다. 정부는 예산에 변경을 가할 필요가 있을 때에는 추가경정예산안을 편성하여 국회에 제출할 수 있다.			
					국회의원이 회기전에 체포 또는 구금된 때에는 현행범인이 아닌 한 국회의 요구가 있으면 회기중 석방된다. 모든 국민은 고문을 받지 아니하며, 형사상 자기에게 불리한 진술을 강요당하지 아니한다.
					국회는 헌법개정안이 공고된 날로부터 60일 이내에 의결하여야 하며, 국회의 의결은 재적의원 3분의 2 이상의 찬성을 얻어야 한다. 헌법재판소는 법률에 저촉되지 아니하는 범위안에서 심판에 관한 절차, 내부규율과 사무처리에 관한 규칙을 제정할 수 있다.</p>
			</div>
			<div class="team_memb_box wrap">
				<ul>
					<li><a href="sub.html"><img src="resource/img/profile.jpg"></a></li>
					<li><a href="sub.html"><img src="resource/img/profile.jpg"></a></li>
					<li><a href="sub.html"><img src="resource/img/profile.jpg"></a></li>
					<li><a href="sub.html"><img src="resource/img/profile.jpg"></a></li>
					<li><a href="sub.html"><img src="resource/img/profile.jpg"></a></li>
				</ul>
			</div>
			<div class="guest_book_wrap">
				<div class="guest_book_box wrap">
					<div class="input_comment_box">
						<textarea id="comment" placeholder="텍스트를 입력해주세요."></textarea>
						<button type="button" id="commentBtn">등록</button>
					</div>
					<div class="comment_list_box">
						<ul id="commentList"></ul>
					</div>
				</div>
			</div>
		</div>
        <script type="module">
			// Firebase SDK 라이브러리 가져오기
			import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
			import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
			import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
			import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

			// Firebase 구성 정보 설정
			const firebaseConfig = {
				apiKey: "AIzaSyAzRZRrFoHhcGrmR78yNNRN2AXwLLm0CnU",
				authDomain: "sparta-f1798.firebaseapp.com",
				projectId: "sparta-f1798",
				storageBucket: "sparta-f1798.appspot.com",
				messagingSenderId: "340506378648",
				appId: "1:340506378648:web:0eddeef3ff3c5d9e5eabed",
				measurementId: "G-JLXDX6XFJC"
			};

			// Firebase 인스턴스 초기화
			const app = initializeApp(firebaseConfig);
			const db = getFirestore(app);


			//방명록 데이터 등록
			$('#commentBtn').click(async function(){
				let comment = $('#comment').val();
                let commentTrim = comment.trim(); //문자열 앞뒤의 공백을 모두 제거
                if (commentTrim = null || commentTrim == ''){
                    //공백만 있을 때
                    alert('텍스트를 입력해주세요.');
                } else {
                    try {
                        const doc = await addDoc(collection(db, 'guestComment'), {
                            'comment': comment,
                        });
                        alert('등록되었습니다.');
                        window.location.reload(); //페이지 새로고침
                    } catch (e) {
                        console.error(e);
                    }
                }
			});

			//방명록 댓글 생성
			$('#commentList').empty(); //empty는 비워주기
			const queryComment = await getDocs(collection(db, 'guestComment'));

			queryComment.forEach((doc) => {
				let comment = doc.data().comment;
                let docId = doc.id; //데이터 아이디 추출
                
                let commentTrim = comment.trim(); //문자열 앞뒤의 공백을 모두 제거

				let tempHtml = `<li id="${docId}"><p>${comment}</p></li>`

                if (commentTrim = null || commentTrim == '') {
                    //공백만 있을 때
                    console.log("여기는 빈칸일때", commentTrim);
                } else {
                    $('#commentList').append(tempHtml);
                }
			});

		</script>
	</body>
</html>